<!DOCTYPE html>
<html>
<head>
</head>
<body>
    <!-- Binaural Audio Section -->
    <!-- Frequency Offset Slider -->
    <input type="range" id="frequencyOffsetSlider" min="0" max="50" value="10">
    <span id="frequencyOffsetDisplay">10</span> <!-- Display the offset value -->

    <!-- Play Button for Binaural Audio -->
    <button id="playButtonBinaural">Play Binaural</button>

    <script>
        let audioContextBinaural = null;
        let leftOscillator = null;
        let rightOscillator = null;
        let audioStarted = false;

        // Initialize the AudioContext
        function initAudioContext() {
            audioContextBinaural = new (window.AudioContext || window.webkitAudioContext)();
            leftOscillator = audioContextBinaural.createOscillator();
            rightOscillator = audioContextBinaural.createOscillator();
            leftOscillator.type = 'sine';
            rightOscillator.type = 'sine';
            leftOscillator.connect(audioContextBinaural.destination);
            rightOscillator.connect(audioContextBinaural.destination);
        }

        function startAudio() {
            if (!audioContextBinaural) {
                initAudioContext();
                updateFrequencyOffset();
            }
            leftOscillator.start();
            rightOscillator.start();
            audioStarted = true;
        }

        function stopAudio() {
            if (audioStarted) {
                leftOscillator.stop();
                rightOscillator.stop();
                leftOscillator.disconnect();
                rightOscillator.disconnect();
                audioStarted = false;
            }
        }

        function updateFrequencyOffset() {
            const offset = parseInt(frequencyOffsetSlider.value);
            frequencyOffsetDisplay.textContent = offset;
            leftOscillator.frequency.setValueAtTime(440, audioContextBinaural.currentTime);
            rightOscillator.frequency.setValueAtTime(440 + offset, audioContextBinaural.currentTime);
        }

        const frequencyOffsetSlider = document.getElementById('frequencyOffsetSlider');
        const frequencyOffsetDisplay = document.getElementById('frequencyOffsetDisplay');
        const playButtonBinaural = document.getElementById('playButtonBinaural');

        playButtonBinaural.addEventListener('click', function() {
            if (!audioContextBinaural) {
                setTimeout(function() {
                    initAudioContext();
                }, 0);
            }

            if (audioContextBinaural.state === 'closed') {
                // Re-enable the audio context if it was closed
                audioContextBinaural = null;
            }

            if (audioContextBinaural.state === 'running') {
                stopAudio();
                playButtonBinaural.textContent = 'Play Binaural';
            } else {
                startAudio();
                playButtonBinaural.textContent = 'Stop Binaural';
            }
        });

        frequencyOffsetSlider.addEventListener('input', updateFrequencyOffset);
    </script>
</body>
</html>
