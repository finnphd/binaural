// Check if the Web Audio API is supported
if (typeof window.AudioContext !== "undefined" || typeof window.webkitAudioContext !== "undefined") {
    const audioContextBinaural = new (window.AudioContext || window.webkitAudioContext)();

    let leftOscillator = null;
    let rightOscillator = null;

    const leftPanNode = audioContextBinaural.createStereoPanner();
    const rightPanNode = audioContextBinaural.createStereoPanner();
    leftPanNode.pan.value = -1;
    rightPanNode.pan.value = 1;

    leftPanNode.connect(audioContextBinaural.destination);
    rightPanNode.connect(audioContextBinaural.destination);

    const leftGainNode = audioContextBinaural.createGain();
    const rightGainNode = audioContextBinaural.createGain();

    leftGainNode.connect(leftPanNode);
    rightGainNode.connect(rightPanNode);

    leftGainNode.gain.value = 0.5;
    rightGainNode.gain.value = 0.5;

    const frequencyOffsetSlider = document.getElementById('frequencyOffsetSlider');
    let frequencyOffset = parseInt(frequencyOffsetSlider.value);

    frequencyOffsetSlider.addEventListener('input', updateFrequencyOffset);

    function updateFrequencyOffset() {
        frequencyOffset = parseInt(frequencyOffsetSlider.value);
        if (leftOscillator && rightOscillator) {
            leftOscillator.frequency.setValueAtTime(440, audioContextBinaural.currentTime);
            rightOscillator.frequency.setValueAtTime(440 + frequencyOffset, audioContextBinaural.currentTime);
        }
    }

    const playButtonBinaural = document.getElementById('playButtonBinaural');
    let isPlayingBinaural = false;

    playButtonBinaural.addEventListener('click', () => {
        if (isPlayingBinaural) {
            leftOscillator.stop();
            rightOscillator.stop();
            leftOscillator.disconnect(leftGainNode);
            rightOscillator.disconnect(rightGainNode);
            leftOscillator = null;
            rightOscillator = null;
            playButtonBinaural.innerText = 'Play Binaural';
            isPlayingBinaural = false;
        } else {
            leftOscillator = audioContextBinaural.createOscillator();
            rightOscillator = audioContextBinaural.createOscillator();
            leftOscillator.type = 'sine';
            rightOscillator.type = 'sine';
            leftOscillator.connect(leftGainNode);
            rightOscillator.connect(rightGainNode);
            leftOscillator.start();
            rightOscillator.start();
            playButtonBinaural.innerText = 'Stop Binaural';
            updateFrequencyOffset();
            isPlayingBinaural = true;
        }
    });

    updateFrequencyOffset();
} else {
    alert("Sorry, your browser doesn't support the Web Audio API.");
}
